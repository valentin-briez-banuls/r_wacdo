<%= form_with(model: @collaborateur, local: true) do |form| %>
  <% if collaborateur.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(collaborateur.errors.count, "erreur") %> empêchent la sauvegarde :</h2>
      <ul>
        <% collaborateur.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :first_name %><br>
    <%= form.text_field :first_name %>
  </div>

  <div>
    <%= form.label :last_name %><br>
    <%= form.text_field :last_name %>
  </div>

  <div>
    <%= form.label :email %><br>
    <%= form.email_field :email %>
  </div>

  <div>
    <%= form.label :admin %><br>
    <%= form.check_box :admin, { id: 'admin-checkbox' } %>
  </div>

  <div id="password-fields" style="<%= @collaborateur.admin? ? '' : 'display:none;' %>">
    <div>
      <%= form.label :password %><br>
      <%= form.password_field :password %>
    </div>

    <div>
      <%= form.label :password_confirmation %><br>
      <%= form.password_field :password_confirmation %>
    </div>
  </div>


  <div>
    <%= form.submit collaborateur.new_record? ? "Créer" : "Mettre à jour" %>
  </div>
  <script>
      document.addEventListener("DOMContentLoaded", function () {
          const adminCheckbox = document.getElementById("admin-checkbox");
          const passwordFields = document.getElementById("password-fields");

          function togglePasswordFields() {
              if (adminCheckbox.checked) {
                  passwordFields.style.display = "block";
              } else {
                  passwordFields.style.display = "none";
                  // Optionnel : vider les champs
                  document.querySelector('[name="collaborateur[password]"]').value = '';
                  document.querySelector('[name="collaborateur[password_confirmation]"]').value = '';
              }
          }

          adminCheckbox.addEventListener("change", togglePasswordFields);
          togglePasswordFields(); // Init au chargement
      });
  </script>

<% end %>
